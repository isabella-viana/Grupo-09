<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gerenciar Participantes | ELEVA</title>
  <link rel="shortcut icon" href="assets/home/logo.svg" type="image/x-icon">
  <link rel="stylesheet" href="css/gerenciamento.css">
  <link rel="stylesheet" href="css/padronizacao.css">
  <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
  <link href="https://fonts.googleapis.com/css2?family=Poppins&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
  <script src="js/direcionadores.js"></script>
</head>

<body onload="carregarParticipantes()">


  <header>
    <div class="header-container">
      <img src="assets/home/logo.svg" alt="">
    </div>
  </header>

  <div class="container-principal">
    <div class="cabecalho-esquerdo">
      <div class="opcoes-cabecalho">
        <div class="foto-usuario">
          <img src="assets/gerenciador/User.svg" alt="">
          <p>Eleva User</p>
        </div>

        <div class="icone" id="dash" onclick="irParaDashboard()">
          <img src="assets/cruds/dashboard.svg" alt="">
          <p>Dashboard</p>
        </div>

        <div class="icone" id="enderecos" onclick="irParaEnderecos()">
          <img src="assets/cruds/enderecos.svg" alt="">
          <p>Endereços</p>
        </div>

        <div class="icone" id="gerenciar" onclick="irParaGerenciar()">
          <img src="assets/cruds/gerenciar.svg" alt="">
          <p>Gerenciar</p>
        </div>

        <div class="icone" id="conta" onclick="irParaConta()">
          <img src="assets/cruds/conta.svg" alt="">
          <p>Conta</p>
        </div>
        <div class="icone" id="solicitacao" onclick="irParaSolicitacao()">
          <img src="assets/cruds/solicitacoes.svg" alt="">
          <p>Solicitações</p>
        </div>
      </div>

      <div class="icone-saida" onclick="sair()">
        <img src="assets/gerenciador/sair.svg" alt="">
      </div>
    </div>


    <div class="container-section">
      <h1>Gerenciar Participantes</h1>


      <div class="botoes-direita">

        <button class="botao adicionar" onclick="telaContato()">
          Adicionar
          <i class="bi bi-plus-circle"></i>
        </button>

        <button class="botao excluir">
          Excluir
          <i class="bi bi-trash"></i>
        </button>

        <button class="botao adicionar" style="margin-right: 5%;">
          Editar
          <i class="bi bi-pencil-square"></i>
        </button>

      </div>
      <div class="tabela">
        <table class="tabela-participantes" >
          <thead>
            <tr>
              <th class="titulo"> </th>
              <th class="titulo"> Nome </th>
              <th class="titulo"> Email </th>
              <th class="titulo"> Telefone </th>
              <th class="titulo"> Área</th>
              <th class="titulo"> Nível </th>
  
  
            </tr>
          </thead>
          <tbody id="tabelaCorpo">
      
        
          </tbody>
        </table>
      </div>

  
    </div>

    <script src="script.js"></script>
</body>

</html>



<script>
  const tabelaCorpo = document.getElementById("tabelaCorpo");
  const botaoAdicionar = document.querySelector(".botao.adicionar");
  const botaoExcluir = document.querySelector(".botao.excluir");
  const formAdicionar = document.getElementById("form-adicionar");

  function adicionarUsuario() {
    window.location.href = "./gerenciamento.html"
  }
  function irAtividade() {
    window.location.href = "./atividades.html"
  }
  function sair() {
    window.location.href = "./index.html"
  }
  function irParaDashboard() {
    window.location.href = "./dashboard.html"
  }

  function irParaSolicitacao() {
    window.location.href = "./solicitacao.html"
  }
  
  windon.onload = ()=>{
    carregarParticipantes();
  };


  botaoAdicionar.addEventListener("click", () => {
    formAdicionar.style.display = "flex";
  });



  function telaContato() {

    window.location.href = "./gerenciar.html"

  }


  botaoCancelar.addEventListener("click", () => {
    formAdicionar.style.display = "none";
  });


  function carregarParticipantes() {
    fetch("/participantes/listar", {
        method: "GET",
        headers: {
            "Content-Type": "application/json"
        },

    }).then(function (resposta) {
        console.log("ESTOU NO THEN DO verificar()!");

        if (resposta.ok) {
            console.log(resposta);

            resposta.json().then(json => {
                console.log("Dados completos:", json);
                console.log("Em formato JSON:", JSON.stringify(json));

                const NOME = json.map(item => item.nome);
                const EMAIL_USUARIO = json.map(item => item.email);
                const TELEFONE= json.map(item => item. telefone);
                const CARGO = json.map(item => item.cargo);

                sessionStorage.setItem("NOME", JSON.stringify(NOME));
                sessionStorage.setItem("EMAIL", JSON.stringify(EMAIL_USUARIO));
                sessionStorage.setItem("TELEFONE", JSON.stringify(TELEFONE));
                sessionStorage.setItem("CARGO", JSON.stringify(CARGO));

                atualizarNomesTabela(NOME,EMAIL_USUARIO,TELEFONE,CARGO);

                
              
            });
        } else {
            console.log("Erro ao puxar os dados do back-end.");
        }
    }).catch(function (erro) {
        console.log("Erro na requisição:", erro);
    });
  }
  
  function atualizarNomesTabela(nomes, email , telefone , cargo){
    tabelaCorpo.innerHTML=""

    for(var i= 0; i < nomes.length ; i++){
      tabelaCorpo.innerHTML+=`
       <tr style="position: sticky;">
            <td><input type="checkbox" class="check-participante" /></td>
            <td>${nomes[i]}</td>
            <td>${email[i]}</td>
            <td>${telefone[i]}</td>
            <td>${cargo[i]}</td>
            <td>View</td>
          </tr>
      `;
    }
  }




  function deletarParticipantes(ids) {
    fetch('http://localhost:3000/participantes', {
      method: 'DELETE',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ ids })
    })
      .then(resposta => {
        if (resposta.ok) {
          alert(`Participantes deletados com sucesso pelo usuário de email: ${sessionStorage.getItem("EMAIL_USUARIO")}!`);
          carregarParticipantes();
        } else if (resposta.status === 404) {
          alert("Participantes não encontrados.");
        } else {
          throw new Error(`Erro ao tentar deletar participantes. Código: ${resposta.status}`);
        }
      })
      .catch(erro => {
        console.error("#ERRO:", erro);
        alert("Erro ao excluir participantes. Veja o console para detalhes.");
      });
  }




  function editarParticipante(id, nome, email, telefone) {
    console.log("Criar função de editar participante - ID:", id);

    fetch(`http://localhost:3000/participantes/${id}`, {
      method: 'PUT',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({ nome, email, telefone })
    })
      .then(function (resposta) {
        if (resposta.ok) {
          window.alert("Participante atualizado com sucesso pelo usuário de email: " + sessionStorage.getItem("EMAIL_USUARIO") + "!");
          carregarParticipantes();
        } else if (resposta.status == 404) {
          window.alert("Erro 404 - Participante não encontrado.");
        } else {
          throw new Error("Houve um erro ao tentar editar o participante! Código da resposta: " + resposta.status);
        }
      })
      .catch(function (erro) {
        console.error("#ERRO:", erro);
        window.alert("Erro ao editar participante. Verifique o console para mais detalhes.");
      });
  }





</script>