<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ELEVA - Gerenciar Participantes</title>
  <link rel="shortcut icon" href="assets/home/logo.svg" type="image/x-icon">
  <link rel="stylesheet" href="css/gerenciamento.css">
  <link rel="stylesheet" href="css/padronizacao.css">
  <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
  <link href="https://fonts.googleapis.com/css2?family=Poppins&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
</head>

<body>

  <header>
    <div class="header-container">
      <img src="imgs/Logo.png" alt="">
    </div>
  </header>

  <div class="container-principal">
    <div class="cabecalho-esquerdo">

      <div class="opcoes-cabecalho">
        <div class="foto-usuario">
          <img src="assets/gerenciador/User.svg" alt="">
          <p>Eleva User</p>
        </div>

        <div class="icone" id="atividade" onclick="irAtividade()">
          <i class="icone-notificacao"></i>
          <p>Atividade</p>
        </div>

        <div class="icone" id="dash" onclick="irParaDashboard()">
          <i class="icone-dashboard"></i>
          <p>Dashboard</p>
        </div>

        <div class="icone" id="grupos" onclick="adicionarUsuario()">
          <i class="icone-grupos"></i>
          <p>Grupos</p>
        </div>
      </div>

      <div class="icone-saida" onclick="sair()">
        <img src="assets/gerenciador/sair.svg" alt="">
      </div>
    </div>

    <div class="container-section">
      <h1>Gerenciar Participantes</h1>

      <table class="tabela-participantes">
        <thead>
          <tr>
            <th colspan="3" class="alinha-direita"></th>
            <th>
              <div class="botoes-direita">
                <button class="botao adicionar" onclick="telaContato()">
                  Adicionar Participante
                  <i class="icone-adicionar"></i>
                </button>
              </div>
            </th>
            <th>
              <button class="botao excluir">
                Excluir Selecionado
                <i class="icone-excluir"></i>
              </button>
            </th>
            <th>
              <div class="botoes-direita">
                <button class="botao adicionar">
                  Editar
                  <i class="icone-editar"></i>
                </button>
              </div>
            </th>
          </tr>
        </thead>
        <tbody id="tabela-corpo">
          <tr>
            <td><input type="checkbox" class="check-participante" /></td>
            <td>Guilherme Queiroz</td>
            <td>usuarioeleva@gmail.com</td>
            <td>11 9999-9990</td>
            <td>Tecled</td>
            <td>View</td>
          </tr>
          <tr>
            <td><input type="checkbox" class="check-participante" /></td>
            <td>Isabella Viana</td>
            <td>usuarioeleva@gmail.com</td>
            <td>11 9999-9990</td>
            <td>Scrum</td>
            <td>View</td>
          </tr>
          <tr>
            <td><input type="checkbox" class="check-participante" /></td>
            <td>Matheus Martinez</td>
            <td>usuarioeleva@gmail.com</td>
            <td>11 9999-9990</td>
            <td>PO</td>
            <td>View</td>
          </tr>
          <tr>
            <td><input type="checkbox" class="check-participante" /></td>
            <td>Pedro Gandin</td>
            <td>usuarioeleva@gmail.com</td>
            <td>11 9999-9990</td>
            <td>Gerente</td>
            <td>Edit</td>
          </tr>
          <tr>
            <td><input type="checkbox" class="check-participante" /></td>
            <td>Victor Hugo</td>
            <td>usuarioeleva@gmail.com</td>
            <td>11 9999-9990</td>
            <td>CIO</td>
            <td>ADM</td>
          </tr>
          <tr>
            <td><input type="checkbox" class="check-participante" /></td>
            <td>Vinícius Gonçalves</td>
            <td>usuarioeleva@gmail.com</td>
            <td>11 9999-9990</td>
            <td>Supervisor</td>
            <td>Edit</td>
          </tr>
        </tbody>
      </table>
    </div>

    <script src="script.js"></script>
</body>

</html>



<script>
  const tabelaCorpo = document.getElementById("tabela-corpo");
  const botaoAdicionar = document.querySelector(".botao.adicionar");
  const botaoExcluir = document.querySelector(".botao.excluir");
  const formAdicionar = document.getElementById("form-adicionar");

  function adicionarUsuario() {
        window.location.href = "./gerenciamento.html"
    }
    function irAtividade() {
        window.location.href = "./atividades.html"
    }
    function sair() {
        window.location.href = "./index.html"
    }
    function irParaDashboard() {
        window.location.href = "./dashboard.html"
    }

  botaoAdicionar.addEventListener("click", () => {
    formAdicionar.style.display = "flex";
  });



  function telaContato() {

    window.location.href = "./gerenciar.html"

  }


  botaoCancelar.addEventListener("click", () => {
    formAdicionar.style.display = "none";
  });




    botaoExcluir.addEventListener("click", async () => {
    const selecionados = document.querySelectorAll(".check-participante:checked");
    const ids = Array.from(selecionados).map(checkbox => {
        return checkbox.closest("tr").dataset.id;
    });

    if (ids.length === 0) {
        window.alert("Selecione pelo menos um participante.");
        return;
    }

    console.log("Criar função de apagar participantes escolhidos - IDs:", ids);

    try {
        const resposta = await fetch('http://localhost:3000/participantes', {
            method: 'DELETE',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ ids })
        });

        if (resposta.ok) {
            window.alert("Participantes deletados com sucesso pelo usuário de email: " + sessionStorage.getItem("EMAIL_USUARIO") + "!");
        
            carregarParticipantes();
        } else if (resposta.status == 404) {
            window.alert("Erro 404 - Participantes não encontrados.");
        } else {
            throw new Error("Houve um erro ao tentar excluir os participantes! Código da resposta: " + resposta.status);
        }
    } catch (erro) {
        console.error("#ERRO:", erro);
        window.alert("Erro ao excluir participantes. Verifique o console para mais detalhes.");
    }
});



 function editarParticipante(id, nome, email, telefone) {
    console.log("Criar função de editar participante - ID:", id);

    fetch(`http://localhost:3000/participantes/${id}`, {
        method: 'PUT',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({ nome, email, telefone })
    })
    .then(function (resposta) {
        if (resposta.ok) {
            window.alert("Participante atualizado com sucesso pelo usuário de email: " + sessionStorage.getItem("EMAIL_USUARIO") + "!");
            carregarParticipantes(); 
        } else if (resposta.status == 404) {
            window.alert("Erro 404 - Participante não encontrado.");
        } else {
            throw new Error("Houve um erro ao tentar editar o participante! Código da resposta: " + resposta.status);
        }
    })
    .catch(function (erro) {
        console.error("#ERRO:", erro);
        window.alert("Erro ao editar participante. Verifique o console para mais detalhes.");
    });
}



    window.onload = carregarParticipantes;


</script>